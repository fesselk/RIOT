<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" type="image/png" href="favicon.png">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Standalone ATmega328p</title>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="jquery.min.js"></script>
    <script src="jquery.powertip.min.js"></script>
    <script src="jquery-ui.min.js"></script>
    <script src="doxy-jquery.js"></script>
    <script src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <!-- Bootstrap -->
    <link href="doxygen.css" rel="stylesheet">
    <link href="fonts.css" rel="stylesheet">
    <link href="bootstrap.min.css" rel="stylesheet">
    <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
    <link href="riot.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
        <script>
            function displaySR(){
            searchBox.Search();
            var rhtml=(document.getElementById('MSearchResults').contentWindow.document.body.innerHTML).replace(/href=\"\.\.\//g,'href="');
            document.getElementById('MSearchResultsWindow').style.display='none';
            document.getElementById('top').append(document.getElementById('MSearchSelectWindow'));
            document.getElementById('top').append(document.getElementById('MSearchResultsWindow'));
            document.getElementById('doc-content').innerHTML=rhtml;
            }
            function modSearch(){
            if(!searchBox.doxySearch){
                searchBox.doxySearch=searchBox.Search
                searchBox.Search= function(){this.doxySearch();
                var r=document.getElementById('MSearchResultsWindow');console.log(r.style);
                if(parseInt(r.style.left)<0)r.style.left=0;
                var x=document.getElementById('MSearchResults');
                if(x.scrollWidth>window.screen.width)x.style.width=window.screen.width-2+'px';
                var f=document.getElementById('riot-searchform');
                if(parseInt( r.style.top) < f.offsetTop+f.scrollHeight) r.style.top = f.offsetTop+f.scrollHeight+'px';}
            }
            }
        </script>
  </head>
  <body>
      <div id="top">
        <nav class="navbar navbar-inverse">
          <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" id="brand-logo" href="http://riot-os.org"><img height="40px" src="riot-logo.svg" /></a>
              <p class="navbar-text text-center visible-xs">Documentation</p>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="navbar-collapse">
              <p class="navbar-text navbar-left"><span id="projectbrief">The friendly Operating System for the Internet of Things</span></p>
              <ul id="riot-navlist" class="nav navbar-nav"></ul>
              <form id="riot-searchform" class="navbar-form navbar-left navbar-right"
                    onsubmit="try{
                        displaySR();
                    }finally{
                            return false;
                    }">
                 <div class="form-group">
                   <div id="MSearchBox" class="MSearchBoxActive">
                     <div class="input-group">
                       <div class="input-group-addon">
                         <span id="MSearchSelect" class="glyphicon glyphicon-search" aria-hidden="true" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"></span>
                       </div>
                       <input class="form-control" type="text" id="MSearchField" placeholder="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event); modSearch();">
                       <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()">
                         <span id="search-reset" class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
                       </a>
                     </div>
                   </div>
                 </div>
              </form>
            </div><!-- /.navbar-collapse -->
          </div><!-- /.container-fluid -->
        </nav>
      </div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__boards__atmega328p.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle">
<div class="title">Standalone ATmega328p<div class="ingroups"><a class="el" href="group__boards.html">Boards</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Support for using the ATmega328p as standalone board.  
<a href="#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Support for using the ATmega328p as standalone board. </p>
<h2>Overview</h2>
<p>The ATmega328p is most popular in the Arduino UNO. However, the 28 PDIP package of the ATmega328p can easily be used without any "board": Just place it on a bread board, and connect a TTL adapter and an ISP and you're ready to go.</p>
<p>The ATmega328p has two internal oscillators, one clocked at 8MHz and one at 128kHz. By default the fuses of the ATmega328p are configured that the internal 8MHz oscillator can be used. This allows the ATmega328p to be operated without any external components at a supply voltage anywhere between 2.7V and 5.5V.</p>
<p> <style>div.image img[src="https://github.com/maribu/images/raw/master/ATmega328p.jpg"]{width:600px;}</style> </p><div class="image">
<img src="https://github.com/maribu/images/raw/master/ATmega328p.jpg" alt="ATmega328p.jpg"/>
<div class="caption">
ATmega328p DIP package on a breadboard</div></div>
<p><br />
</p>
<h3>MCU</h3>
<table class="doxtable">
<tr>
<th align="left">MCU </th><th align="left">ATmega328p  </th></tr>
<tr>
<td align="left">Family </td><td align="left">AVR/ATmega </td></tr>
<tr>
<td align="left">Vendor </td><td align="left">Microchip (previously Atmel) </td></tr>
<tr>
<td align="left">RAM </td><td align="left">2KiB </td></tr>
<tr>
<td align="left">Flash </td><td align="left">32KiB </td></tr>
<tr>
<td align="left">EEPROM </td><td align="left">1KiB </td></tr>
<tr>
<td align="left">Frequency </td><td align="left">1MHz/8MHz (up to 20MHz with external clock) </td></tr>
<tr>
<td align="left">Timers </td><td align="left">3 (2x 8bit, 1x 16bit) </td></tr>
<tr>
<td align="left">ADCs </td><td align="left">6 analog input pins </td></tr>
<tr>
<td align="left">UARTs </td><td align="left">1 </td></tr>
<tr>
<td align="left">SPIs </td><td align="left">1 </td></tr>
<tr>
<td align="left">I2Cs </td><td align="left">1 (called TWI) </td></tr>
<tr>
<td align="left">Vcc </td><td align="left">2.7V - 5.5V (when clocked at 8MHz) </td></tr>
<tr>
<td align="left">Datasheet </td><td align="left"><a href="http://ww1.microchip.com/downloads/en/DeviceDoc/ATmega48A-PA-88A-PA-168A-PA-328-P-DS-DS40002061A.pdf">Official datasheet</a> </td></tr>
</table>
<h3>Pinout</h3>
<p> <style>div.image img[src="https://camo.githubusercontent.com/c55beef2f138da61fe671a1e4a307ff4ffbc318d/68747470733a2f2f692e696d6775722e636f6d2f715849456368542e6a7067"]{width:100%;}</style> </p><div class="image">
<img src="https://camo.githubusercontent.com/c55beef2f138da61fe671a1e4a307ff4ffbc318d/68747470733a2f2f692e696d6775722e636f6d2f715849456368542e6a7067" alt="68747470733a2f2f692e696d6775722e636f6d2f715849456368542e6a7067"/>
<div class="caption">
Pinout of the ATmega328p</div></div>
<p><br />
</p>
<p>All credit for above pinout image goes to <a href="https://github.com/MCUdude/MiniCore#pinout">https://github.com/MCUdude/MiniCore#pinout</a></p>
<h3>Clock Frequency</h3>
<p>The ATmega328p has two internal oscillators clocked at 8MHz and at 128kHz that allow it to be operated without any external clock source or crystal. By default the fuses are configured to use the internal 8MHz oscillator and a clock divider resulting in a clock speed of 1MHz. By clearing the <code>CKDIV8</code> fuse the clock divider can be disabled to operate the ATmega328p at 8MHz without an external clock source. This can be done like this: </p><pre class="fragment">avrdude -c usbtiny -p m328p -B 32 -U lfuse:w:0xe2:m
</pre><p>(Replace <code>usbtiny</code> with the ISP programmer you are using. The <code>-B 32</code> might be needed on some ISP programmers to communicate with slow ATmega MCUs. It will not be needed anymore after the clock device has been disabled.)</p>
<p>This "board" is configured to use 8MHz as core clock, so that the ATmega328p runs at the highest frequency possible without external clock sources.</p>
<p>By setting the environment variable <code>ATMEGA328P_CLOCK</code> to a custom frequency in Hz (e.g. <code>1000000</code> for 1MHz), this core clock can be changed easily. Refer to the datasheet on how to configure the ATmega328p to use an external crystal, an external clock source or the clock divider.</p>
<h3>Relation Between Supply Voltage, Clock Frequency and Power Consumption</h3>
<p>A higher supply voltage results in a higher current drawn. Thus, lower power consumption can be achieved by using a lower supply voltage. However, higher clock frequencies require higher supply voltages for reliable operation.</p>
<p>The lowest possible supply voltage at 8 MHz is 2.7V (with some safety margin), which results in an active supply current of less than 3 mA (about 8 mW power consumption) according to the datasheet. At 1 MHz core clock a supply voltage of 1.8V is possible resulting in an active supply current of less than 0.3 mA (about 0.5 mW power consumption). For more details, refer to the official datasheet.</p>
<h2>Flashing the Device</h2>
<p>In order to flash the ATmega328P without a bootloader, an ICSP programmer is needed. Connect the programmer as follows:</p>
<table class="doxtable">
<tr>
<th align="left">ISCP pin </th><th align="left">ATmega328p pin  </th></tr>
<tr>
<td align="left">MISO </td><td align="left">18/PB4/MISO </td></tr>
<tr>
<td align="left">VCC </td><td align="left">7/VCC </td></tr>
<tr>
<td align="left">SCK </td><td align="left">19/PB5/SCK </td></tr>
<tr>
<td align="left">MOSI </td><td align="left">17/PB3/MOSI </td></tr>
<tr>
<td align="left">RESET </td><td align="left">1/RESET </td></tr>
<tr>
<td align="left">Ground </td><td align="left">22/GND </td></tr>
</table>
<p>The tool <code>avrdude</code> needs to be installed. When using the <code>usbtiny</code> (or one of the super cheap clones) running </p><pre class="fragment">make BOARD=atmega328p flash
</pre><p>will take care of everything. To use the programmer <code>&lt;FOOBAR&gt;</code> instead, run </p><pre class="fragment">make BOARD=atmega328p PROGRAMMER=&lt;FOOBAR&gt; flash
</pre><h2>Serial Terminal</h2>
<p>Connect a TTL adapter with pins 2/RXD and 3/TXD an run </p><pre class="fragment">make BOARD=atmega328p term
</pre><p>Please note that the supply voltage should be compatible with the logic level of the TTL adapter. Usually everything between 3.3 V and 5 V should work.</p>
<h2>On-Chip Debugging (OCD)</h2>
<p>E.g. with the AVR Dragon and <a href="http://avarice.sourceforge.net/">AVaRICE</a> you can debug the ATmega328P using the debugWIRE interface. Compared to the ATmega MCUs with JTAG interface the debug facilities are however significantly reduced: Only a single hardware breakpoint and no watchpoints are supported. The hardware breakpoint is used for single-stepping. If you set breakpoints, the AVR Dragon will transparently replace the instruction to break upon with a break instruction. Once the breakpoint is hit, the break instruction is overwritten with the original instruction. Thus, every breakpoint hit cause two flash cycles to be performed, which not only results in a slow debugging experience, but also causes significant wear.</p>
<p>In order to enable debugWIRE run (replace <code>&lt;PROGRAMMER&gt;</code> with the programmer you use, e.g. with <code>dragon_isp</code> if you use the AVR Dragon): </p><pre class="fragment">avrdude -c &lt;PROGRAMMER&gt; -p m328p -U hfuse:w:0x99:m
</pre><p>You can disable it again via: </p><pre class="fragment">avrdude -c &lt;PROGRAMMER&gt; -p m328p -U hfuse:w:0xd9:m
</pre><dl class="section warning"><dt>Warning</dt><dd>As the reset pin is repurposed for debugWIRE, a regular ISP will not be able to disable the debugWIRE interface anymore. The AVR Dragon can temporary disable the debugWIRE interface via a debugWIRE command and avrdude will do so when debugWIRE is used. So only enable debugWIRE if you have an AVR DRagon or other means to disable debugWIRE later on again.</dd></dl>
<p>For debugging, the ATmega328P needs to be connected to the AVR Dragon in the very same way it needs to be connected for programming (see above). Once the MCU is connected and debugWIRE is enabled via the fuse settings, you can start debugging via: </p><pre class="fragment">make debug
</pre><p>If this fails after flashing the ATmega328P, it is like due to debugWIRE being temporary disabled by avrdude in order to use the ISP feature. Perform a cold boot and the ATmega328P will have debugWIRE enabled again.</p>
<dl class="section note"><dt>Note</dt><dd>If you are using a different debugger than the AVR Dragon, you have to export the <code>AVR_DEBUGDEVICE</code> environment variable to the required flag to pass to AVaRICE, e.g. when using the Atmel-ICE you have to export <code>AVR_DEBUGDEVICE=--edbg</code>. If the debug device is not connected via USB, you also need to export <code>AVR_DEBUGINTERFACE</code> to the correct value.</dd></dl>
<h2>Caution</h2>
<p>Don't expect having a working network stack due to very limited resources ;-) </p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:atmega328p_2include_2board_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="atmega328p_2include_2board_8h.html">board.h</a></td></tr>
<tr class="memdesc:atmega328p_2include_2board_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Board specific definitions for the standalone ATmega328p "board". <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:boards_2atmega328p_2include_2periph__conf_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="boards_2atmega328p_2include_2periph__conf_8h.html">periph_conf.h</a></td></tr>
<tr class="memdesc:boards_2atmega328p_2include_2periph__conf_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Peripheral MCU configuration for the ATmega328p standalone "board". <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
    <div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
        <ul>
            <li class="footer">Generated on Fri Jul 3 2020 23:49:38 by <a href="http://www.doxygen.org/index.html">
                       <img class="footer" src="doxygen.png" alt="doxygen"></a> 1.8.13</li>
        </ul>
    </div>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap.min.js"></script>
    <script src="jquery.smartmenus.min.js"></script>
    <script src="jquery.smartmenus.bootstrap.min.js"></script>
    <script src="riot-doxy.js"></script>
  </body>
</html>
