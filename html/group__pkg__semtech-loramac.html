<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" type="image/png" href="favicon.png">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Semtech LoRaMAC implementation</title>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="jquery.min.js"></script>
    <script src="jquery.powertip.min.js"></script>
    <script src="jquery-ui.min.js"></script>
    <script src="doxy-jquery.js"></script>
    <script src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <!-- Bootstrap -->
    <link href="doxygen.css" rel="stylesheet">
    <link href="fonts.css" rel="stylesheet">
    <link href="bootstrap.min.css" rel="stylesheet">
    <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
    <link href="riot.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
      <div id="top">
        <nav class="navbar navbar-inverse">
          <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" id="brand-logo" href="http://riot-os.org"><img height="40px" src="riot-logo.svg" /></a>
              <p class="navbar-text text-center visible-xs">Documentation</p>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="navbar-collapse">
              <p class="navbar-text navbar-left"><span id="projectbrief">The friendly Operating System for the Internet of Things</span></p>
              <ul id="riot-navlist" class="nav navbar-nav"></ul>
              <!--BEGIN SEARCHENGINE hidden-sm hidden-xs"-->
              <form id="riot-searchform" class="navbar-form navbar-left navbar-right"
                    onsubmit="try{
    var rhtml=(document.getElementById('MSearchResults').contentWindow.document.body.innerHTML).replaceAll('href=\"../','href=\"');
    document.getElementById('MSearchResultsWindow').style.display='none';
    document.getElementById('top').append(document.getElementById('MSearchSelectWindow'));
    document.getElementById('top').append(document.getElementById('MSearchResultsWindow'));
    document.getElementById('doc-content').innerHTML=rhtml;
}finally{
                            return false;
                    }">
                 <div class="form-group">
                   <div id="MSearchBox" class="MSearchBoxActive">
                     <div class="input-group">
                       <div class="input-group-addon">
                         <span id="MSearchSelect" class="glyphicon glyphicon-search" aria-hidden="true" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"></span>
                       </div>
                       <input class="form-control" type="text" id="MSearchField" placeholder="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event);
                              var r=document.getElementById('MSearchResultsWindow');
                              if(parseInt(r.style.left)<0)r.style.left=0;
                              var x=document.getElementById('MSearchResults');
                              if(x.scrollWidth>window.screen.width)x.style.width=window.screen.width-2+'px';
                              var f=document.getElementById('riot-searchform');
                              if(parseInt( r.style.top) < f.offsetTop+f.scrollHeight) r.style.top = f.offsetTop+f.scrollHeight+'px';">
                       <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()">
                         <span id="search-reset" class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
                       </a>
                     </div>
                   </div>
                 </div>
              </form>
            </div><!-- /.navbar-collapse -->
          </div><!-- /.container-fluid -->
        </nav>
      </div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__pkg__semtech-loramac.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle">
<div class="title">Semtech LoRaMAC implementation<div class="ingroups"><a class="el" href="group__pkg.html">Packages</a> &#124; <a class="el" href="group__net.html">Networking</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Provides a RIOT adaption of Semtech LoRaMAC implementation.  
<a href="#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Provides a RIOT adaption of Semtech LoRaMAC implementation. </p>
<h1>Introduction</h1>
<p>This package provides an API built on top of the <a href="https://github.com/Lora-net/LoRaMac-node">Semtech LoRaMAC-node</a> reference implementation of a LoRa network.</p>
<h1>Importing this package in an application</h1>
<p>This package only works with Semtech SX1272 and SX1276 radio devices. Thus, in order to use it properly, the application <code>Makefile</code> must import the corresponding device driver: </p><div class="fragment"><div class="line">USEMODULE += sx1272  # <span class="keywordflow">for</span> a SX1272 radio device</div><div class="line">USEMODULE += sx1276  # <span class="keywordflow">for</span> a SX1276 radio device</div></div><!-- fragment --><p>In order to use this package in an application, add the following in the application <code>Makefile</code>: </p><div class="fragment"><div class="line">USEPKG += semtech-loramac</div></div><!-- fragment --><p>Since the LoRa radio depends on regional parameters regarding the access to the physical support, the region where the device is used needs to be set at compile time. Example for EU868: </p><div class="fragment"><div class="line">LORA_REGION = EU868</div></div><!-- fragment --><h1>Using the package API</h1>
<p>The package provides a simple API for initializing the MAC, setting/getting parameters, joining a network and sending/receiving packets to/from a LoRa Network.</p>
<p>In your <code>main.c</code>, some header files must be first included: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="loramac_8h.html">net/loramac.h</a>&quot;</span>     <span class="comment">/* core loramac definitions */</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="semtech__loramac_8h.html">semtech_loramac.h</a>&quot;</span> <span class="comment">/* package API */</span></div></div><!-- fragment --><p>Then define global variables: </p><div class="fragment"><div class="line"><a class="code" href="structsemtech__loramac__t.html">semtech_loramac_t</a> loramac;  <span class="comment">/* The loramac stack device descriptor */</span></div><div class="line"><span class="comment">/* define the required keys for OTAA, e.g over-the-air activation (the</span></div><div class="line"><span class="comment">   null arrays need to be updated with valid LoRa values) */</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> uint8_t deveui[<a class="code" href="group__net__loramac.html#ga70fc848c906d0ffd5b7d40f6b56c6f69">LORAMAC_DEVEUI_LEN</a>] = { 0x00, 0x00, 0x00, 0x00, \</div><div class="line">                                                    0x00, 0x00, 0x00, 0x00 };</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> uint8_t appeui[<a class="code" href="group__net__loramac.html#ga4f92f7a51ff00b67535b877f1309e4e1">LORAMAC_APPEUI_LEN</a>] = { 0x00, 0x00, 0x00, 0x00, \</div><div class="line">                                                    0x00, 0x00, 0x00, 0x00 };</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> uint8_t appkey[<a class="code" href="group__net__loramac.html#ga4044842cd3dfca9733ab144d8d1a6343">LORAMAC_APPKEY_LEN</a>] = { 0x00, 0x00, 0x00, 0x00, \</div><div class="line">                                                    0x00, 0x00, 0x00, 0x00, \</div><div class="line">                                                    0x00, 0x00, 0x00, 0x00, \</div><div class="line">                                                    0x00, 0x00, 0x00, 0x00 };</div></div><!-- fragment --><p>Now in the <code>main</code> function:</p><ol type="1">
<li>initialize the LoRaMAC MAC layer</li>
<li>set the LoRa keys</li>
<li>join the network</li>
<li>send some data to the network</li>
</ol>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* 1. initialize the LoRaMAC MAC layer */</span></div><div class="line">    <a class="code" href="semtech__loramac_8h.html#aa6e500cb5bf3afe2d45ecfc3b43f68fe">semtech_loramac_init</a>(&amp;loramac);</div><div class="line"></div><div class="line">    <span class="comment">/* 2. set the keys identifying the device */</span></div><div class="line">    <a class="code" href="semtech__loramac_8h.html#a3f621621ffe38f3dc9f4f8931a711685">semtech_loramac_set_deveui</a>(&amp;loramac, deveui);</div><div class="line">    <a class="code" href="semtech__loramac_8h.html#a94bf64c581eeb129948ed84168fed736">semtech_loramac_set_appeui</a>(&amp;loramac, appeui);</div><div class="line">    <a class="code" href="semtech__loramac_8h.html#a9bbc0c8fea451102f2bebfe29fac802a">semtech_loramac_set_appkey</a>(&amp;loramac, appkey);</div><div class="line"></div><div class="line">    <span class="comment">/* 3. join the network */</span></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="semtech__loramac_8h.html#a103f907189b45a8303c2b462797b52f9">semtech_loramac_join</a>(&amp;loramac, <a class="code" href="group__net__loramac.html#gga0ec6851e0578ec1270e16e3faa54f4cda842a2cf228ae0d498a0c2425092aaeca">LORAMAC_JOIN_OTAA</a>) != <a class="code" href="semtech__loramac_8h.html#a2ed332df4696233768771e93d4081c3fadeb07e54826e0af30766731ecacab95f">SEMTECH_LORAMAC_JOIN_SUCCEEDED</a>) {</div><div class="line">        puts(<span class="stringliteral">&quot;Join procedure failed&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line">    puts(<span class="stringliteral">&quot;Join procedure succeeded&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">/* 4. send some data */</span></div><div class="line">    <span class="keywordtype">char</span> *message = <span class="stringliteral">&quot;This is RIOT&quot;</span>;</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="semtech__loramac_8h.html#a86f9839a9d80bddb15bb745922767e99">semtech_loramac_send</a>(&amp;loramac,</div><div class="line">                             (uint8_t *)message, strlen(message)) != <a class="code" href="semtech__loramac_8h.html#a2ed332df4696233768771e93d4081c3fa7228f456428873a7692c93d192db670b">SEMTECH_LORAMAC_TX_DONE</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;Cannot send message &#39;%s&#39;\n&quot;</span>, message);</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p>To receive downlink messages, enable the <code>semtech_loramac_rx</code> and use a dedicated receiving thread.</p><ul>
<li>In the application Makefile, add <div class="fragment"><div class="line">USEMODULE += semtech_loramac_rx</div></div><!-- fragment --></li>
<li>At the beginning of the application source file, add the necessary includes and declare the message queue and stack arrays: <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;thread.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define RECV_MSG_QUEUE                   (4U)</span></div><div class="line"><span class="keyword">static</span> <a class="code" href="structmsg__t.html">msg_t</a> _recv_queue[RECV_MSG_QUEUE];</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> _recv_stack[<a class="code" href="group__core__thread.html#ga713ebddc00581f4d415095cdbfd8791f">THREAD_STACKSIZE_DEFAULT</a>];</div></div><!-- fragment --></li>
<li>Implement the thread: it initializes its message queue and then simply calls the blocking <code>semtech_loramac_recv</code> function in a loop: <div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *_recv(<span class="keywordtype">void</span> *arg)</div><div class="line">{</div><div class="line">    <a class="code" href="group__core__msg.html#ga480e6f32c8ab18579b62a890f3fda2cd">msg_init_queue</a>(_recv_queue, RECV_MSG_QUEUE);</div><div class="line"></div><div class="line">    (void)arg;</div><div class="line">    <span class="keywordflow">while</span> (1) {</div><div class="line">        <span class="comment">/* blocks until some data is received */</span></div><div class="line">        <a class="code" href="semtech__loramac_8h.html#a613004dd4b92feb21126e12e6d71a3bc">semtech_loramac_recv</a>(&amp;loramac);</div><div class="line">        loramac.<a class="code" href="structsemtech__loramac__t.html#aca408c680431b6c860783f70d0a90e3a">rx_data</a>.<a class="code" href="structsemtech__loramac__rx__data__t.html#a49c1fbb22eca46d13bd2e073ab8c366e">payload</a>[loramac.<a class="code" href="structsemtech__loramac__t.html#aca408c680431b6c860783f70d0a90e3a">rx_data</a>.<a class="code" href="structsemtech__loramac__rx__data__t.html#aa7f7bd85afcb31f8046759b5670b1101">payload_len</a>] = 0;</div><div class="line">        printf(<span class="stringliteral">&quot;Data received: %s, port: %d\n&quot;</span>,</div><div class="line">               (<span class="keywordtype">char</span> *)loramac.<a class="code" href="structsemtech__loramac__t.html#aca408c680431b6c860783f70d0a90e3a">rx_data</a>.<a class="code" href="structsemtech__loramac__rx__data__t.html#a49c1fbb22eca46d13bd2e073ab8c366e">payload</a>, loramac.<a class="code" href="structsemtech__loramac__t.html#aca408c680431b6c860783f70d0a90e3a">rx_data</a>.<a class="code" href="structsemtech__loramac__rx__data__t.html#ad28f25f98e9831a3c9c401e15494fbd9">port</a>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> NULL;</div><div class="line">}</div></div><!-- fragment --></li>
<li>Finally, this thread can be started after the join procedure succeeds: <div class="fragment"><div class="line"><a class="code" href="group__core__thread.html#ga7e0403a9aa86ce0ec136f6b069d4434a">thread_create</a>(_recv_stack, <span class="keyword">sizeof</span>(_recv_stack),</div><div class="line">              <a class="code" href="group__core__thread.html#gac57374d1c51374ebf95d9679281af818">THREAD_PRIORITY_MAIN</a> - 1, 0, _recv, NULL, <span class="stringliteral">&quot;recv thread&quot;</span>);</div></div><!-- fragment --></li>
</ul>
<h1>Persistence</h1>
<p>If the board CPU provides an internal EEPROM, this package provides a mechanism for storing EUIs, keys and some MAC parameters (frame counter, join status). After a successful join procedure, use <code>semtech_loramac_save</code> function to persist this information and it will be loaded automatically at the next reboot. If the device is already joined to a network, to avoid another OTAA join procedure use <code>semtech_loramac_is_mac_joined</code> function to check the join status of the device.</p>
<p>This mechanism is especially useful when using deep sleep power modes that don't preserve RAM.</p>
<dl class="section warning"><dt>Warning</dt><dd>It is not possible to directly call the original LoRaMAC-node API using this package. This package should only be considered as a wrapper around the original LoRaMAC-node API and only the API provided by this package should be used.</dd></dl>
<h1>License</h1>
<p>The library is using the BSD 3-clause license.</p>
<dl class="section see"><dt>See also</dt><dd><a href="https://github.com/Lora-net/LoRaMac-node">https://github.com/Lora-net/LoRaMac-node</a> </dd></dl>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:pkg_2semtech-loramac_2include_2semtech-loramac_2timer_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pkg_2semtech-loramac_2include_2semtech-loramac_2timer_8h.html">timer.h</a></td></tr>
<tr class="memdesc:pkg_2semtech-loramac_2include_2semtech-loramac_2timer_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Semtech LoRaMAC timer compatibility definitions. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:semtech__loramac_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="semtech__loramac_8h.html">semtech_loramac.h</a></td></tr>
<tr class="memdesc:semtech__loramac_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Public API and definitions of the Semtech LoRaMAC. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
    <div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
        <ul>
            <li class="footer">Generated on Thu Jul 2 2020 17:48:23 by <a href="http://www.doxygen.org/index.html">
                       <img class="footer" src="doxygen.png" alt="doxygen"></a> 1.8.13</li>
        </ul>
    </div>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap.min.js"></script>
    <script src="jquery.smartmenus.min.js"></script>
    <script src="jquery.smartmenus.bootstrap.min.js"></script>
    <script src="riot-doxy.js"></script>
  </body>
</html>
