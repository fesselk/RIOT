<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" type="image/png" href="favicon.png">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Kconfig in RIOT</title>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="jquery.min.js"></script>
    <script src="jquery.powertip.min.js"></script>
    <script src="jquery-ui.min.js"></script>
    <script src="doxy-jquery.js"></script>
    <script src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <!-- Bootstrap -->
    <link href="doxygen.css" rel="stylesheet">
    <link href="fonts.css" rel="stylesheet">
    <link href="bootstrap.min.css" rel="stylesheet">
    <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
    <link href="riot.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
        <script>
            function displaySR(){
            var rhtml=(document.getElementById('MSearchResults').contentWindow.document.body.innerHTML).replace(/href=\"\.\.\//g,'href="');
            document.getElementById('MSearchResultsWindow').style.display='none';
            document.getElementById('top').append(document.getElementById('MSearchSelectWindow'));
            document.getElementById('top').append(document.getElementById('MSearchResultsWindow'));
            document.getElementById('doc-content').innerHTML=rhtml;
            }
        </script>
  </head>
  <body>
      <div id="top">
        <nav class="navbar navbar-inverse">
          <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" id="brand-logo" href="http://riot-os.org"><img height="40px" src="riot-logo.svg" /></a>
              <p class="navbar-text text-center visible-xs">Documentation</p>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="navbar-collapse">
              <p class="navbar-text navbar-left"><span id="projectbrief">The friendly Operating System for the Internet of Things</span></p>
              <ul id="riot-navlist" class="nav navbar-nav"></ul>
              <!--BEGIN SEARCHENGINE hidden-sm hidden-xs"-->
              <form id="riot-searchform" class="navbar-form navbar-left navbar-right"
                    onsubmit="try{
                        displaySR();
                    }finally{
                            return false;
                    }">
                 <div class="form-group">
                   <div id="MSearchBox" class="MSearchBoxActive">
                     <div class="input-group">
                       <div class="input-group-addon">
                         <span id="MSearchSelect" class="glyphicon glyphicon-search" aria-hidden="true" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"></span>
                       </div>
                       <input class="form-control" type="text" id="MSearchField" placeholder="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event);
                              var r=document.getElementById('MSearchResultsWindow');
                              if(parseInt(r.style.left)<0)r.style.left=0;
                              var x=document.getElementById('MSearchResults');
                              if(x.scrollWidth>window.screen.width)x.style.width=window.screen.width-2+'px';
                              var f=document.getElementById('riot-searchform');
                              if(parseInt( r.style.top) < f.offsetTop+f.scrollHeight) r.style.top = f.offsetTop+f.scrollHeight+'px';">
                       <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()">
                         <span id="search-reset" class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
                       </a>
                     </div>
                   </div>
                 </div>
              </form>
            </div><!-- /.navbar-collapse -->
          </div><!-- /.container-fluid -->
        </nav>
      </div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('kconfig-in-riot.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Kconfig in RIOT </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#kconfig-overview">Overview</a></li>
<li class="level1"><a href="#kconfig-users-guide">User&#39;s guide to configure with Kconfig</a><ul><li class="level2"><a href="#configure-using-menuconfig">Configure using menuconfig</a></li>
<li class="level2"><a href="#configure-using-files">Configure using &#39;.config&#39; files</a></li>
<li class="level2"><a href="#app-config-kconfig">Application configuration with Kconfig</a></li>
</ul>
</li>
<li class="level1"><a href="#kconfig-integration-into-build-system">Integration into the build system</a><ul><li class="level2"><a href="#kconfig-steps-build-process">Steps during the build process</a><ul><li class="level3"><a href="#kconfig-steps-merge-configs">2. Merging all configuration sources</a></li>
<li class="level3"><a href="#kconfig-steps-header-gen">4. Generation of the autoconf.h header</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#kconfig-transition-phase">Transition phase</a><ul><li class="level2"><a href="#kconfig-configuration-optional">Making configuration via Kconfig optional</a></li>
<li class="level2"><a href="#kconfig-cpu-boards-features">Modelling CPUs, boards and provided features</a></li>
</ul>
</li>
<li class="level1"><a href="#kconfig-appendixes">Appendixes</a><ul><li class="level2"><a href="#kconfig-appendix-a">Appendix A: Check if a module or package is used</a></li>
<li class="level2"><a href="#kconfig-appendix-b">Appendix B: Difference between &#39;Kconfig&#39; and &#39;.config&#39; files</a></li>
<li class="level2"><a href="#kconfig-appendix-c">Appendix C: Pitfall when using different configuration interfaces</a></li>
<li class="level2"><a href="#kconfig-appendix-d">Appendix D: A few key aspects while exposing a macro to Kconfig</a></li>
</ul>
</li>
<li class="level1"><a href="#kconfig-useful-references">Useful references</a></li>
</ul>
</div>
<div class="textblock"><p>The objective of using Kconfig in RIOT is to configure software modules at compile-time. This means having a standard way of:</p><ul>
<li>Exposing configurable parameters</li>
<li>Assigning application and user-specific configurations</li>
<li>Verifying these parameters<ul>
<li>Check possible values</li>
<li>Check valid configuration considering inter-dependencies</li>
</ul>
</li>
<li>Applying the selected configuration</li>
</ul>
<h1><a class="anchor" id="kconfig-overview"></a>
Overview</h1>
<h2>Exposure</h2>
<p>Modules in RIOT expose their configurable parameters via Kconfig files (for more information on Kconfig syntax check <a href="https://www.kernel.org/doc/html/latest/kbuild/kconfig-language.html">the specification</a>). In these files documentation, restrictions, default values and dependencies can be expressed.</p>
<p>Kconfig files are structured through the file system mirroring the current module distribution. In time, all modules will have Kconfig files to make themselves configurable through this system.</p>
<h2>Assignment</h2>
<p>The user can assign values to the exposed parameters, either by manually writing '.config' files or using an interface such as Menuconfig. Parameters with no assigned values will take the default ones. For a detailed distinction between Kconfig and '.config' files see <a href="#kconfig-appendix-b">Appendix B</a>.</p>
<h2>Verification and application</h2>
<p>Using '.config' and Kconfig files the build system takes care of doing the necessary checks on the values according to the parameter definition. After that, the <code>autoconf.h</code> header file is generated, it contains all the configurations in the form of (<code>CONFIG_</code> prefixed) macros. </p><hr/>
 <h1><a class="anchor" id="kconfig-users-guide"></a>
User's guide to configure with Kconfig</h1>
<h2><a class="anchor" id="configure-using-menuconfig"></a>
Configure using menuconfig</h2>
<p>In order to use the graphical interface menuconfig to configure the application, run <code>make menuconfig</code> in the application's folder. All available configurations (based on the used modules) for the particular platform will be presented. By default, the configuration of a module via Kconfig is not enabled. In order to activate the configuration via Kconfig the corresponding option should be selected. That will enable the configuration of all inner options, if available.</p>
<p>Once the desired configuration is achieved save the configuration to the default proposed path and exit. The saved configuration will be applied when the code is compiled (<code>make all</code>).</p>
<p>If the current configuration will be used in the future it can be saved in the application's folder as <code>user.config</code>, using the 'Save' option in menuconfig. This way it will be persistent after cleaning the application directory (<code>make clean</code>).</p>
<h2><a class="anchor" id="configure-using-files"></a>
Configure using '.config' files</h2>
<p>The second way to configure the application is by directly writing '.config' files. Two files will be sources of configuration during the generation of the final header file: <code>app.config</code> and <code>user.config</code>, which should be placed inside the application's folder. <code>app.config</code> sets default configuration values for the particular application, the user can override them by setting them in <code>user.config</code>.</p>
<p>Let's say that the <code>SOCK_UTIL_SCHEME_MAXLEN</code> symbol in <code>sock_util</code> module needs to be configured. The <code>user.config</code> file could look like:</p>
<div class="fragment"><div class="line"># activate configuration of sock_util using Kconfig</div><div class="line">CONFIG_KCONFIG_MODULE_SOCK_UTIL=y</div><div class="line"># change scheme part length</div><div class="line">CONFIG_SOCK_UTIL_SCHEME_MAXLEN=24</div></div><!-- fragment --><p>In this case, there is no need for using menuconfig. It's enough just to call <code>make all</code> in the application folder, as this configuration will be read and applied. Note that if any dependency issue occurs, warnings will be generated (e.g. not enabling the configuration of a module via Kconfig).</p>
<h2><a class="anchor" id="app-config-kconfig"></a>
Application configuration with Kconfig</h2>
<p>To expose application-specific configuration options a <code>Kconfig</code> file can be placed in the application's folder. For an example of this you can check the <a href="https://github.com/RIOT-OS/RIOT/tree/master/tests/kconfig">tests/kconfig</a> application.</p>
<h2>A note on the usage of CFLAGS</h2>
<p>When a certain module is being configured via Kconfig the configuration macro will not longer be overridable by means of CFLAGS (e.g. set on the compilation command or on a Makefile). Consider this if you are getting a 'redefined warning'.</p>
<h2>A note on the usage of the 'clean' command</h2>
<p>When using Kconfig as the configurator for RIOT, configuration symbols may be used in Makefiles through the build system. For this to work properly make sure that when cleaning an application you call <code>make clean &amp;&amp; make all</code>, instead of <code>make clean all</code>. </p><hr/>
 <h1><a class="anchor" id="kconfig-integration-into-build-system"></a>
Integration into the build system</h1>
<p>The integration of Kconfig into the build system is mainly done in <code>makefiles/kconfig.mk</code>.</p>
<h2><a class="anchor" id="kconfig-steps-build-process"></a>
Steps during the build process</h2>
<div class="image">
<object type="image/svg+xml" data="kconfig_integration.svg">kconfig_integration.svg</object>
<div class="caption">
Ouput of every step of the build process</div></div>
 <h3>0. Module dependency resolution</h3>
<p>Currently, the resolution of module dependencies is performed by the build system where all the used modules and packages end up listed in the <code>USEMODULE</code> make variables. In the next phases of integration we plan to resolve dependencies using Kconfig.</p>
<h4>Input</h4>
<ul>
<li>Makefiles.</li>
</ul>
<h4>Output</h4>
<ul>
<li><code>USEMODULE</code> and <code>USEPKG</code> variables.</li>
</ul>
<h3>1. Module listing</h3>
<p>The list of modules needed for the particular build is dumped into the <code>$ (GENERATED_DIR)/Kconfig.dep</code> file, where each module is translated into a Kconfig symbol as documented in <a href="#kconfig-appendix-a">Appendix A</a>.</p>
<h4>Input</h4>
<ul>
<li><code>USEMODULE</code> and <code>USEPKG</code> variables</li>
</ul>
<h4>Output</h4>
<ul>
<li><code>$ (GENERATED_DIR)/Kconfig.dep</code> file</li>
</ul>
<h3><a class="anchor" id="kconfig-steps-merge-configs"></a>
2. Merging all configuration sources</h3>
<p>In this step configuration values are taken from multiple sources and merged into a single <code>merged.config</code> configuration file. This file is temporary and is removed on clean. If the user needs to save a particular configuration set, a backup has to be saved (this can be done using the menuconfig interface) so it can be loaded later in this step.</p>
<p>To accomplish merging of multiple input files, the <code>mergeconfig</code> script is used. Note that <b>the order matters</b>: existing configuration values are merged in the order expressed in the input section, where the last value assigned to a parameter has the highest priority. If no configuration files are available all default values will be applied.</p>
<p><code>merged.config</code> is the only configuration input for the <code>autoconf.h</code> in the <a href="#kconfig-steps-header-gen">generation step</a>.</p>
<h4>Input</h4>
<ul>
<li>Optional:<ul>
<li><code>$ (APPDIR)/app.config</code>: Application specific default configurations.</li>
<li><code>$ (APPDIR)/user.config</code>: Configurations saved by user.</li>
</ul>
</li>
</ul>
<h4>Output</h4>
<ul>
<li><code>$ (GENERATED_DIR)/merged.config</code> file.</li>
</ul>
<h3>3. Menuconfig execution (optional)</h3>
<p>Menuconfig is a graphical interface for software configuration. It is used for the configuration of the Linux kernel. This section explains the process that occurs when RIOT is being configured using the menuconfig interface.</p>
<p>The main <code>Kconfig</code> file is used in this step to show the configurable parameters of the system. Kconfig will filter innaplicable parameters (i.e. parameters exposed by modules that are not being used) based on the file <code>$ (GENERATED_DIR)/Kconfig.dep</code> generated in step 1.</p>
<p>During the transition phase, the user needs to enable Kconfig explicitly per module, by setting the corresponding option. If using <code>menuconfig</code> a checkbox with a submenu has to be selected, if using <code>.config</code> files a <code>CONFIG_KCONFIG_MODULE_</code> prefixed option has to be set to <code>y</code>. For more information see <a href="#kconfig-configuration-optional">Making configuration via Kconfig optional</a>.</p>
<p>Note that if Kconfig is not used to configure a module, the corresponding header files default values will be used.</p>
<p><code>merged.config</code> is one of the inputs for menuconfig. This means that any configuration that the application defines in the <code>app.config</code> or a backup configuration from the user in <code>user.config</code> are taken into account on the first run (see <a href="#kconfig-appendix-c">Appendix C</a>).</p>
<p>In this step the user chooses configuration values (or selects the minimal configuration) and saves it to the <code>merged.config</code> file. Here the user can choose to save a backup configuration file for later at a different location (e.g. a <code>user.config</code> file in the application folder).</p>
<h4>Input</h4>
<ul>
<li><code>/Kconfig</code> file.</li>
<li>Optional:<ul>
<li><code>$ (APPDIR)/app.config</code></li>
<li><code>$ (APPDIR)/user.config</code></li>
<li><code>$ (GENERATED_DIR)/merged.config</code></li>
</ul>
</li>
</ul>
<h4>Output</h4>
<ul>
<li>Updated <code>$ (GENERATED_DIR)/merged.config</code> file.</li>
<li><code>$ (GENERATED_DIR)/merged.config.old</code> backup file.</li>
</ul>
<h3><a class="anchor" id="kconfig-steps-header-gen"></a>
4. Generation of the autoconf.h header</h3>
<p>With the addition of Kconfig a dependency has been added to the build process: the <code>$ (GENERATED_DIR)/autoconf.h</code> header file. This header file is the main output from the Kconfig configuration system. It holds all the macros that should be used to configure modules in RIOT: <code>CONFIG_&lt;module&gt;_&lt;parameter&gt;</code>.</p>
<p>In order to generate the <code>autoconf.h</code> file the <code>genconfig</code> script is used. Inputs for this script are the main <code>Kconfig</code> file and <code>merged.config</code> configuration file, which holds the selected values for the exposed parameters.</p>
<h4>Input:</h4>
<ul>
<li><code>$ (GENERATED_DIR)/merged.config</code> file.</li>
<li>Main <code>Kconfig</code> file exposing configuration of modules.</li>
</ul>
<h4>Output:</h4>
<ul>
<li><code>$ (GENERATED_DIR)/autoconf.h</code> configuration header file.</li>
<li><code>$ (GENERATED_DIR)/out.config</code> file.</li>
</ul>
<h3>Summary of files</h3>
<p>These files are defined in <code>kconfig.mk</code>.</p>
<table class="doxtable">
<tr>
<th>File </th><th>Description  </th></tr>
<tr>
<td><code>Kconfig</code> </td><td>Defines configuration options of modules. </td></tr>
<tr>
<td><code>Kconfig.dep</code> </td><td>Holds a list of the modules that are being compiled. </td></tr>
<tr>
<td><code>app.config</code> </td><td>Holds default application configuration values. </td></tr>
<tr>
<td><code>user.config</code> </td><td>Holds configuration values applied by the user. </td></tr>
<tr>
<td><code>merged.config</code> </td><td>Holds configuration from multiple sources. Used to generate header. </td></tr>
<tr>
<td><code>autoconf.h</code> </td><td>Header file containing the macros that applied the selected configuration. </td></tr>
<tr>
<td><code>out.config</code> </td><td>Configuration file containing all the symbols defined in <code>autoconf.h</code>. </td></tr>
</table>
<h2>Kconfig symbols in Makefiles</h2>
<p>As '.config' files have Makefile syntax they can be included when building, which allows to access the applied configuration from the build system and, in the future, to check for enabled modules.</p>
<p>During migration this is also useful, as it gives the ability to check if a parameter is being configured via Kconfig or a default value via <code>CFLAGS</code> could be injected. For example:</p>
<div class="fragment"><div class="line">ifndef CONFIG_USB_VID</div><div class="line">  CFLAGS += -DCONFIG_USB_VID=0x1209</div><div class="line">endif</div></div><!-- fragment --><p>Symbols will have the same name as the configuration macros (thus will always have the <code>CONFIG_</code> prefix). As the configuration file is loaded in <code>Makefile.include</code> care should be taken when performing checks in the application's Makefile. The symbols will not be defined until after including <code>Makefile.include</code>. </p><hr/>
 <h1><a class="anchor" id="kconfig-transition-phase"></a>
Transition phase</h1>
<h2><a class="anchor" id="kconfig-configuration-optional"></a>
Making configuration via Kconfig optional</h2>
<p>During transition to the usage of Kconfig as the main configurator for RIOT, the default behavior will be the traditional one: expose configuration options in header files and use CFLAGS as inputs. To allow optional configuration via Kconfig, a convention will be used when writing Kconfig files.</p>
<p>Modules should be contained in their own <code>menuconfig</code> entries, this way the user can choose to enable the configuration via Kconfig for an specific module. These entries should define a dependency on the module they configure (see <a href="#kconfig-appendix-a">Appendix A</a> to see how to check if a module is being used).</p>
<p>The module configuration then can be enabled either via the menuconfig interface:</p>
<div class="image">
<img src="kconfig_menuconfig.png" alt="kconfig_menuconfig.png"/>
<div class="caption">
menuconfig-example</div></div>
<p> or by means of a '.config' file:</p>
<div class="fragment"><div class="line">CONFIG_KCONFIG_MODULE_GCOAP=y</div></div><!-- fragment --><h2><a class="anchor" id="kconfig-cpu-boards-features"></a>
Modelling CPUs, boards and provided features</h2>
<p>During the current migration phase architectures, CPUs, boards and provided features are being modelled in Kconfig. The following is a guide on how to organize and name the symbols.</p>
<h3>Features</h3>
<p>Features must be modelled as hidden boolean symbols with the prefix <code>HAS_</code>. They must contain a <code>help</code> attribute clearly specifying what providing that feature means. The location of the symbol declaration depends on the type of feature. Features that are not platform-specific (e.g. <code>arch_32bit</code> or <code>cpp</code>) must be placed in <code>/kconfigs/Kconfig.features</code>. If a feature is specific to a certain CPU family or vendor, it should be placed in the correspondent Kconfig file (e.g. <code>esp_wifi_enterprise</code>). Features related to modules should be placed in the Kconfig file of that module.</p>
<h4>Example</h4>
<p>The feature <code>arduino</code> is placed in <code>/kconfigs/Kconfig.features</code> and modelled like:</p>
<div class="fragment"><div class="line">config HAS_ARDUINO</div><div class="line">    bool</div><div class="line">    help</div><div class="line">        Indicates that Arduino pins compatibility is supported.</div></div><!-- fragment --><h3>CPUs</h3>
<p>The proposed hierarchy for the classification of CPUs is as follows:</p>
<div class="fragment"><div class="line">                    +------------+</div><div class="line">More Specific       | CPU_MODEL  |</div><div class="line">      +             +------------+</div><div class="line">      |</div><div class="line">      |</div><div class="line">      |             +------------+</div><div class="line">      |             |  CPU_FAM   |</div><div class="line">      |             +------------+</div><div class="line">      |</div><div class="line">      |</div><div class="line">      |             +------------+</div><div class="line">      |             |  CPU_CORE  |</div><div class="line">      |             +------------+</div><div class="line">      |</div><div class="line">      |</div><div class="line">      v             +------------+</div><div class="line">Less Specific       |  CPU_ARCH  |</div><div class="line">                    +------------+</div></div><!-- fragment --><p>Where each hierarchy is defined as:</p><ul>
<li><code>CPU_MODEL</code>: The specific identifier of the used CPU, used for some CPU implementations to differentiate between different memory layouts.</li>
<li><code>CPU_FAM</code>: An intermediate identifier between CPU and CPU_MODEL that represents a sub-group of a Manufacturers CPU's.</li>
<li><code>CPU_CORE</code>: The specific identifier of the core present in the CPU.</li>
<li><code>CPU_ARCH</code>: The specific identifier of the architecture of the core defined in <code>CPU_CORE</code>.</li>
</ul>
<p>In order to model the hierarchies, a hidden boolean symbol must be declared for each. The name of the symbol must begin with the correspondent prefix and must be followed by the specific value. For instance, the 'samd21' family symbol is named <code>CPU_FAM_SAMD21</code>.</p>
<p>In addition, a default value to the correspondent common symbol must be defined. The default value must be guarded by the boolean symbol correspondent to the hierarchy.</p>
<p>Features may be provided by any hierarchy symbol. Usually symbols are selected from more specific to less specific. This means that a <code>CPU_MODEL_&lt;model&gt;</code> symbol usually would select the correspondent <code>CPU_FAM_&lt;family&gt;</code> symbol, which would in turn select the <code>CPU_CORE_&lt;core&gt;</code>. This may change in some cases where <code>CPU_COMMON_</code> symbols are defined to avoid repetition.</p>
<p>In addition to the symbols of the hierarchy described above, a default value to the <code>CPU</code> symbol should be assigned, which will match the value of the <code>CPU</code> Makefile variable in the build system.</p>
<p>The declaration of the symbols should be placed in a <code>Kconfig</code> file in the folder that corresponds to the hierarchy. When the symbols are scattered into multiple files, it is responsibility of file containing the most specific symbols to <code>source</code> the less specific. Keep in mind that only the file located in <code>/cpu/&lt;CPU&gt;/Kconfig</code> will be included by the root <code>/Kconfig</code> file.</p>
<h4>Example</h4>
<div class="fragment"><div class="line"># This is the most specific symbol (selected by the board)</div><div class="line"># The CPU model selects the family it belongs to</div><div class="line">config CPU_MODEL_SAMR21G18A</div><div class="line">    bool</div><div class="line">    select CPU_FAM_SAMD21</div><div class="line"></div><div class="line"># In this case the family selects a common &#39;sam0&#39; symbol (which provides some</div><div class="line"># features), and the core it has (cortex-m0+)</div><div class="line">config CPU_FAM_SAMD21</div><div class="line">    bool</div><div class="line">    select CPU_COMMON_SAM0</div><div class="line">    select CPU_CORE_CORTEX_M0PLUS</div><div class="line">    select HAS_CPU_SAMD21</div><div class="line">    select HAS_PUF_SRAM</div><div class="line"></div><div class="line"># The value of the common value depends on the selected model</div><div class="line">config CPU_MODEL</div><div class="line">    default &quot;samd21e18a&quot; if CPU_MODEL_SAMD21E18A</div><div class="line">    default &quot;samd21g18a&quot; if CPU_MODEL_SAMD21G18A</div><div class="line">    default &quot;samd21j18a&quot; if CPU_MODEL_SAMD21J18A</div><div class="line">    default &quot;samr21e18a&quot; if CPU_MODEL_SAMR21E18A</div><div class="line">    default &quot;samr21g18a&quot; if CPU_MODEL_SAMR21G18A</div><div class="line"></div><div class="line">config CPU_FAM</div><div class="line">    default &quot;samd21&quot; if CPU_FAM_SAMD21</div></div><!-- fragment --><h3>Boards</h3>
<p>Boards must be modelled as hidden boolean symbols with the prefix <code>BOARD_</code> which default to <code>y</code> and are placed in <code>/boards/&lt;BOARD&gt;/Kconfig</code>. This file will be <code>source</code>d from the main <code>/Kconfig</code> file. The board symbol must select the <code>CPU_MODEL_&lt;model&gt;</code> symbol that corresponds to the CPU model present on the board. The board symbol must also select the symbols that correspond to the features it provides.</p>
<p>In the same <code>Kconfig</code> file a default value must be assigned to the common <code>BOARD</code> symbol. It must be guarded by the board's symbol, so it only applies in that case.</p>
<p>There are cases when grouping common code for multiple boards helps to avoid unnecessary repetition. In the case features are provided in a common board folder (e.g. <code>/boards/common/arduino-atmega</code>) a symbol should be declared to model this in Kconfig. Symbols for common boards must have the <code>BOARD_COMMON_</code> prefix, and must select the common provided features.</p>
<h4>Example</h4>
<p>The samr21-xpro has a <code>samr21g18a</code> CPU and provides multiple features. Its symbol is modelled as following:</p>
<div class="fragment"><div class="line"># /boards/samr21-xpro/Kconfig</div><div class="line"></div><div class="line">config BOARD</div><div class="line">    default &quot;samr21-xpro&quot; if BOARD_SAMR21_XPRO</div><div class="line"></div><div class="line">config BOARD_SAMR21_XPRO</div><div class="line">    bool</div><div class="line">    default y</div><div class="line">    select CPU_MODEL_SAMR21G18A</div><div class="line">    select HAS_PERIPH_ADC</div><div class="line">    select HAS_PERIPH_I2C</div><div class="line">    select HAS_PERIPH_PWM</div><div class="line">    select HAS_PERIPH_RTC</div><div class="line">    select HAS_PERIPH_RTT</div><div class="line">    select HAS_PERIPH_SPI</div><div class="line">    select HAS_PERIPH_TIMER</div><div class="line">    select HAS_PERIPH_UART</div><div class="line">    select HAS_PERIPH_USBDEV</div><div class="line">    select HAS_RIOTBOOT</div></div><!-- fragment --><h2>Summary of reserved Kconfig prefixes</h2>
<p>The following symbol prefixes have been assigned particular semantics and are reserved for the cases described bellow:</p>
<table class="doxtable">
<tr>
<th align="left">Prefix </th><th align="left">Description  </th></tr>
<tr>
<td align="left"><code>BOARD_</code> </td><td align="left">Models a board </td></tr>
<tr>
<td align="left"><code>BOARD_COMMON_</code> </td><td align="left">Used for common symbols used by multiple boards </td></tr>
<tr>
<td align="left"><code>CPU_ARCH_</code> </td><td align="left">Models a CPU architecture </td></tr>
<tr>
<td align="left"><code>CPU_COMMON_</code> </td><td align="left">Used for common symbols used by multiple CPUs </td></tr>
<tr>
<td align="left"><code>CPU_CORE_</code> </td><td align="left">Models a CPU core </td></tr>
<tr>
<td align="left"><code>CPU_FAM_</code> </td><td align="left">Models a family of CPUs </td></tr>
<tr>
<td align="left"><code>CPU_MODEL_</code> </td><td align="left">Models a particular model of CPU </td></tr>
<tr>
<td align="left"><code>HAS_</code> </td><td align="left">Models a <a href="build-system-basics.html#features">feature</a> </td></tr>
<tr>
<td align="left"><code>KCONFIG_MODULE_</code> </td><td align="left">Used during transition to enable configuration of a module via Kconfig </td></tr>
<tr>
<td align="left"><code>KCONFIG_PKG_</code> </td><td align="left">Used during transition to enable configuration of a package via Kconfig </td></tr>
<tr>
<td align="left"><code>MODULE_</code> </td><td align="left">Models a <a href="creating-modules.html#creating-modules">RIOT module</a> </td></tr>
<tr>
<td align="left"><code>PKG_</code> </td><td align="left">Models an <a href="group__pkg.html">external package</a> </td></tr>
</table>
<hr/>
 <h1><a class="anchor" id="kconfig-appendixes"></a>
Appendixes</h1>
<h2><a class="anchor" id="kconfig-appendix-a"></a>
Appendix A: Check if a module or package is used</h2>
<p>In order to show only the relevant configuration parameters to the user with respect to a given application and board selection, Kconfig needs knowledge about all modules and packages to be used for a compilation. Currently dependency handling among modules is performed by the build system (via <code>Makefile.dep</code> files). The interface defined to declared the used modules and packages is the <code>$ (GENERATED_DIR)/Kconfig.dep</code> file.</p>
<p><code>Kconfig.dep</code> is a Kconfig file that will define symbols of the form: </p><div class="fragment"><div class="line">config MODULE_SOCK_UTIL</div><div class="line">    bool</div><div class="line">    default y</div></div><!-- fragment --><p> There will be a symbol for every used module (i.e. every module in <code>USEMODULE</code> make variable) and package. The names in the symbols will be uppercase and separated by <code>_</code>. Based on these symbols configurability is decided. Modules and packages symbols will have <code>MODULE_</code> and <code>PKG_</code> prefixes respectively.</p>
<p>The following is an example of how to use these symbols in Kconfig files to enable/disable a configuration menu:</p>
<div class="fragment"><div class="line">menuconfig KCONFIG_MODULE_SOCK_UTIL</div><div class="line">    bool &quot;Configure Sock Utilities&quot;</div><div class="line">    depends on MODULE_SOCK_UTIL</div><div class="line">    help</div><div class="line">        &quot;Configure Sock Utilities using Kconfig.&quot;</div></div><!-- fragment --><p>Then, every configuration option for the previous module would be modeled like:</p>
<div class="fragment"><div class="line">if KCONFIG_MODULE_SOCK_UTIL</div><div class="line"></div><div class="line">config SOCK_UTIL_SCHEME_MAXLEN</div><div class="line">    int &quot;Maximum length of the scheme part for sock_urlsplit&quot;</div><div class="line">    default 16</div><div class="line"></div><div class="line">endif # KCONFIG_MODULE_SOCK_UTIL</div></div><!-- fragment --><h2><a class="anchor" id="kconfig-appendix-b"></a>
Appendix B: Difference between 'Kconfig' and '.config' files</h2>
<p>Kconfig files describe a configuration database, which is a collection of configuration options organized in a tree structure. Configuration options may have dependencies (among other attributes), which are used to determine their visibility.</p>
<p>Kconfig files are written in <a href="https://www.kernel.org/doc/Documentation/kbuild/kconfig-language.txt">Kconfig language</a> defined in the Linux kernel. Configuration options have attributes such as types, prompts and default values.</p>
<h4>Kconfig file</h4>
<div class="fragment"><div class="line">menu &quot;Buffer Sizes&quot;</div><div class="line"></div><div class="line">config GCOAP_PDU_BUF_SIZE</div><div class="line">    int &quot;Request or response buffer size&quot;</div><div class="line">    default 128</div><div class="line"></div><div class="line">endmenu</div></div><!-- fragment --><p>On the other hand configuration files contain assignment of values to configuration options and use Makefile syntax. They can also be used to save a set of configuration values as backup.</p>
<h4>'.config' file</h4>
<div class="fragment"><div class="line"># enable Kconfig configuration for gcoap</div><div class="line">CONFIG_KCONFIG_MODULE_GCOAP=y</div><div class="line"># set the value</div><div class="line">CONFIG_GCOAP_PDU_BUF_SIZE=12345</div></div><!-- fragment --><p>In other words: Kconfig files describe configuration options and '.config' files assign their values.</p>
<h2><a class="anchor" id="kconfig-appendix-c"></a>
Appendix C: Pitfall when using different configuration interfaces</h2>
<p>In the current configuration flow the user can choose to configure RIOT using the menuconfig graphical interface or writing '.config' files by hand.</p>
<p>As explained in the <a href="#kconfig-steps-merge-configs">'Configuration sources merging step'</a> of the configuration process, configuration from multiple sources are loaded to create a single <code>merged.config</code> file, and the order of merging matters: last file has priority.</p>
<p>While editing values directly via '.config' files <code>merged.config</code> will be re-built. Once the user decides to edit <code>merged.config</code> directly using menuconfig, the file will not be re-built anymore, and any changes by manually editing the source files will have no effect. To go back to manual edition a <code>make clean</code> has to be issued in the application directory.</p>
<h2><a class="anchor" id="kconfig-appendix-d"></a>
Appendix D: A few key aspects while exposing a macro to Kconfig</h2>
<p>A macro that holds a 0 or 1 is modelled in Kconfig as a <code>bool</code> symbol. References to this macro can then make use of IS_ACTIVE macro from <a class="el" href="kernel__defines_8h.html" title="Common macros and compiler attributes/pragmas configuration. ">kernel_defines.h</a> with C conditionals for conditional compilation. <a href="https://github.com/RIOT-OS/RIOT/pull/13914">FXOS8700 driver exposure to Kconfig</a> can be considered as an example. If the macro is defined as <code>TRUE</code> by default, a new symbol gets introduced to invert the semantics. The recommended practice is to add a new symbol and expose it to Kconfig while the old one is tagged to be deprecated. The process is documented in this <a href="https://github.com/RIOT-OS/RIOT/pull/13129/commits/c7b6dc587cf20f3177abe0417a408b6ab90d0ff8">commit</a></p>
<p>There may be cases where a macro is expected to hold only specific values, e.g. 'GNRC_IPV6_MSG_QUEUE_SIZE' expressed as the power of two. These may be modelled in such a way that a new macro is introduced to hold the restricted figures while operators are added to arrive at the desired value. The process is documented in this <a href="https://github.com/RIOT-OS/RIOT/pull/14086">pull request.</a></p>
<h1><a class="anchor" id="kconfig-useful-references"></a>
Useful references</h1>
<ul>
<li><a href="https://www.kernel.org/doc/html/latest/kbuild/kconfig-language.html">Kconfig language specification</a></li>
<li><a href="https://www.kernel.org/doc/html/latest/kbuild/kconfig-macro-language.html">Kconfig macro language specification</a></li>
<li><a href="https://docs.zephyrproject.org/latest/guides/kconfig/tips.html">Kconfig - Tips and Best Practices</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
    <div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
        <ul>
            <li class="footer">Generated on Fri Jul 3 2020 13:27:53 by <a href="http://www.doxygen.org/index.html">
                       <img class="footer" src="doxygen.png" alt="doxygen"></a> 1.8.13</li>
        </ul>
    </div>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap.min.js"></script>
    <script src="jquery.smartmenus.min.js"></script>
    <script src="jquery.smartmenus.bootstrap.min.js"></script>
    <script src="riot-doxy.js"></script>
  </body>
</html>
