<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" type="image/png" href="favicon.png">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>sys/include/riotboot/flashwrite.h File Reference</title>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="jquery.min.js"></script>
    <script src="jquery.powertip.min.js"></script>
    <script src="jquery-ui.min.js"></script>
    <script src="doxy-jquery.js"></script>
    <script src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <!-- Bootstrap -->
    <link href="doxygen.css" rel="stylesheet">
    <link href="fonts.css" rel="stylesheet">
    <link href="bootstrap.min.css" rel="stylesheet">
    <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
    <link href="riot.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
      <div id="top">
        <nav class="navbar navbar-inverse">
          <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" id="brand-logo" href="http://riot-os.org"><img height="40px" src="riot-logo.svg" /></a>
              <p class="navbar-text text-center visible-xs">Documentation</p>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="navbar-collapse">
              <p class="navbar-text navbar-left"><span id="projectbrief">The friendly Operating System for the Internet of Things</span></p>
              <ul id="riot-navlist" class="nav navbar-nav"></ul>
              <!--BEGIN SEARCHENGINE hidden-sm hidden-xs"-->
              <form id="riot-searchform" class="navbar-form navbar-left navbar-right"
                    onsubmit="try{
                        var rhtml=document.getElementById('MSearchResults').contentWindow.document.body.innerHTML;
                        document.getElementById('MSearchResultsWindow').style.display='none';
                        document.getElementById('top').append(document.getElementById('MSearchSelectWindow'));
                        document.getElementById('top').append(document.getElementById('MSearchResultsWindow'));
                        document.getElementById('doc-content').innerHTML=rhtml;
                        }finally{
                            return false;
                    }">
                 <div class="form-group">
                   <div id="MSearchBox" class="MSearchBoxActive">
                     <div class="input-group">
                       <div class="input-group-addon">
                         <span id="MSearchSelect" class="glyphicon glyphicon-search" aria-hidden="true" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"></span>
                       </div>
                       <input class="form-control" type="text" id="MSearchField" placeholder="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event);
                              r=document.getElementById('MSearchResultsWindow');
                              if(parseInt(r.style.left)<0)r.style.left=0;">
                       <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()">
                         <span id="search-reset" class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
                       </a>
                     </div>
                   </div>
                 </div>
              </form>
            </div><!-- /.navbar-collapse -->
          </div><!-- /.container-fluid -->
        </nav>
      </div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('flashwrite_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">flashwrite.h File Reference<div class="ingroups"><a class="el" href="group__sys.html">System</a> &raquo; <a class="el" href="group__sys__riotboot__flashwrite.html">riotboot flash writer</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>riotboot flash writing module  
<a href="#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>riotboot flash writing module </p>
<p>This module provides an API to reliably write a firmware image to flash.</p>
<p>The API is similar to stream hashing functions:</p>
<ol type="1">
<li>initialize state structure using <a class="el" href="flashwrite_8h.html#a43c19f2a98b8671fb9785aad3ba63eea" title="Initialize firmware update (riotboot version) ">riotboot_flashwrite_init()</a></li>
<li>put some data using <a class="el" href="flashwrite_8h.html#af8f53f0bca4123772b1221bed52abcca" title="Feed bytes into the firmware writer. ">riotboot_flashwrite_putbytes()</a></li>
<li>repeat 2. until all data has been received</li>
<li>finish update using <a class="el" href="flashwrite_8h.html#af394e6c45f029eaa246c756383be8378" title="Finish a firmware update (riotboot version) ">riotboot_flashwrite_finish()</a></li>
</ol>
<p>The module will <em>not</em> automatically reboot after an image has been successfully written.</p>
<p>Under the hood, the module tries to abstract page sizes for writing the image to flash. Verification of the image is left to the caller. If the data is not correctly written, riotboot_put_bytes() will return -1.</p>
<p>The module makes sure that at no point in time an invalid image is bootable. The algorithm for that makes use of the bootloader verifying checksum and works as follows:</p>
<ol type="1">
<li>erase first block (making its checksum invalid)</li>
<li>write image starting at second block</li>
<li>write first block</li>
</ol>
<dl class="section author"><dt>Author</dt><dd>Kaspar Schleiser <a href="#" onclick="location.href='mai'+'lto:'+'kas'+'pa'+'r@s'+'ch'+'lei'+'se'+'r.d'+'e'; return false;">kaspa<span style="display: none;">.nosp@m.</span>r@sc<span style="display: none;">.nosp@m.</span>hleis<span style="display: none;">.nosp@m.</span>er.d<span style="display: none;">.nosp@m.</span>e</a> </dd>
<dd>
Koen Zandberg <a href="#" onclick="location.href='mai'+'lto:'+'koe'+'n@'+'ber'+'gz'+'and'+'.n'+'et'; return false;">koen@<span style="display: none;">.nosp@m.</span>berg<span style="display: none;">.nosp@m.</span>zand.<span style="display: none;">.nosp@m.</span>net</a> </dd></dl>

<p class="definition">Definition in file <a class="el" href="flashwrite_8h_source.html">flashwrite.h</a>.</p>
</div><div class="textblock"><code>#include &quot;<a class="el" href="slot_8h_source.html">riotboot/slot.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="flashpage_8h_source.html">periph/flashpage.h</a>&quot;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for flashwrite.h:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="flashwrite_8h__incl.svg" width="392" height="276"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div><div class="textblock"><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> This graph shows which files directly or indirectly include this file:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="flashwrite_8h__dep__incl.svg" width="188" height="202"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="flashwrite_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structriotboot__flashwrite__t.html">riotboot_flashwrite_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">firmware update state structure  <a href="structriotboot__flashwrite__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:acb9a6a59c19a2431a3820ce863b5defc"><td class="memItemLeft" align="right" valign="top"><a id="acb9a6a59c19a2431a3820ce863b5defc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flashwrite_8h.html#acb9a6a59c19a2431a3820ce863b5defc">RIOTBOOT_FLASHWRITE_SKIPLEN</a>&#160;&#160;&#160;sizeof(<a class="el" href="riotboot_2hdr_8h.html#a62edf563d94d69db0f0cdc2c774c231b">RIOTBOOT_MAGIC</a>)</td></tr>
<tr class="memdesc:acb9a6a59c19a2431a3820ce863b5defc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Amount of bytes to skip at initial write of first page. <br /></td></tr>
<tr class="separator:acb9a6a59c19a2431a3820ce863b5defc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8f63924bc9bf572db48bb24336b3e8c2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flashwrite_8h.html#a8f63924bc9bf572db48bb24336b3e8c2">riotboot_flashwrite_init_raw</a> (<a class="el" href="structriotboot__flashwrite__t.html">riotboot_flashwrite_t</a> *state, int target_slot, <a class="el" href="msp430__types_8h.html#a7c94ea6f8948649f8d181ae55911eeaf">size_t</a> offset)</td></tr>
<tr class="memdesc:a8f63924bc9bf572db48bb24336b3e8c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize firmware update (raw version)  <a href="#a8f63924bc9bf572db48bb24336b3e8c2">More...</a><br /></td></tr>
<tr class="separator:a8f63924bc9bf572db48bb24336b3e8c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43c19f2a98b8671fb9785aad3ba63eea"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flashwrite_8h.html#a43c19f2a98b8671fb9785aad3ba63eea">riotboot_flashwrite_init</a> (<a class="el" href="structriotboot__flashwrite__t.html">riotboot_flashwrite_t</a> *state, int target_slot)</td></tr>
<tr class="memdesc:a43c19f2a98b8671fb9785aad3ba63eea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize firmware update (riotboot version)  <a href="#a43c19f2a98b8671fb9785aad3ba63eea">More...</a><br /></td></tr>
<tr class="separator:a43c19f2a98b8671fb9785aad3ba63eea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8f53f0bca4123772b1221bed52abcca"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flashwrite_8h.html#af8f53f0bca4123772b1221bed52abcca">riotboot_flashwrite_putbytes</a> (<a class="el" href="structriotboot__flashwrite__t.html">riotboot_flashwrite_t</a> *state, const uint8_t *bytes, <a class="el" href="msp430__types_8h.html#a7c94ea6f8948649f8d181ae55911eeaf">size_t</a> len, bool more)</td></tr>
<tr class="memdesc:af8f53f0bca4123772b1221bed52abcca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Feed bytes into the firmware writer.  <a href="#af8f53f0bca4123772b1221bed52abcca">More...</a><br /></td></tr>
<tr class="separator:af8f53f0bca4123772b1221bed52abcca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9520d64ff40abc05ded901c9527560a2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flashwrite_8h.html#a9520d64ff40abc05ded901c9527560a2">riotboot_flashwrite_finish_raw</a> (<a class="el" href="structriotboot__flashwrite__t.html">riotboot_flashwrite_t</a> *state, const uint8_t *bytes, <a class="el" href="msp430__types_8h.html#a7c94ea6f8948649f8d181ae55911eeaf">size_t</a> len)</td></tr>
<tr class="memdesc:a9520d64ff40abc05ded901c9527560a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finish a firmware update (raw version)  <a href="#a9520d64ff40abc05ded901c9527560a2">More...</a><br /></td></tr>
<tr class="separator:a9520d64ff40abc05ded901c9527560a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af394e6c45f029eaa246c756383be8378"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flashwrite_8h.html#af394e6c45f029eaa246c756383be8378">riotboot_flashwrite_finish</a> (<a class="el" href="structriotboot__flashwrite__t.html">riotboot_flashwrite_t</a> *state)</td></tr>
<tr class="memdesc:af394e6c45f029eaa246c756383be8378"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finish a firmware update (riotboot version)  <a href="#af394e6c45f029eaa246c756383be8378">More...</a><br /></td></tr>
<tr class="separator:af394e6c45f029eaa246c756383be8378"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68b26d35167bd543d9f2fc1156290db8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="msp430__types_8h.html#a7c94ea6f8948649f8d181ae55911eeaf">size_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flashwrite_8h.html#a68b26d35167bd543d9f2fc1156290db8">riotboot_flashwrite_slotsize</a> (const <a class="el" href="structriotboot__flashwrite__t.html">riotboot_flashwrite_t</a> *state)</td></tr>
<tr class="memdesc:a68b26d35167bd543d9f2fc1156290db8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a slot's size.  <a href="#a68b26d35167bd543d9f2fc1156290db8">More...</a><br /></td></tr>
<tr class="separator:a68b26d35167bd543d9f2fc1156290db8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56dfacc4a69c91d00803807521b3d775"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flashwrite_8h.html#a56dfacc4a69c91d00803807521b3d775">riotboot_flashwrite_verify_sha256</a> (const uint8_t *sha256_digest, <a class="el" href="msp430__types_8h.html#a7c94ea6f8948649f8d181ae55911eeaf">size_t</a> img_size, int target_slot)</td></tr>
<tr class="memdesc:a56dfacc4a69c91d00803807521b3d775"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify the digest of an image.  <a href="#a56dfacc4a69c91d00803807521b3d775">More...</a><br /></td></tr>
<tr class="separator:a56dfacc4a69c91d00803807521b3d775"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="af394e6c45f029eaa246c756383be8378"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af394e6c45f029eaa246c756383be8378">&#9670;&nbsp;</a></span>riotboot_flashwrite_finish()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int riotboot_flashwrite_finish </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structriotboot__flashwrite__t.html">riotboot_flashwrite_t</a> *&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Finish a firmware update (riotboot version) </p>
<p>This function finishes a firmware update by re-writing the first header so it includes riotboot's magic number ("RIOT").</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">state</td><td>ptr to previously used state structure</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, &lt;0 otherwise </dd></dl>

<p class="definition">Definition at line <a class="el" href="flashwrite_8h_source.html#l00160">160</a> of file <a class="el" href="flashwrite_8h_source.html">flashwrite.h</a>.</p>

</div>
</div>
<a id="a9520d64ff40abc05ded901c9527560a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9520d64ff40abc05ded901c9527560a2">&#9670;&nbsp;</a></span>riotboot_flashwrite_finish_raw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int riotboot_flashwrite_finish_raw </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structriotboot__flashwrite__t.html">riotboot_flashwrite_t</a> *&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="msp430__types_8h.html#a7c94ea6f8948649f8d181ae55911eeaf">size_t</a>&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finish a firmware update (raw version) </p>
<p>This function finishes a firmware update by re-writing the first header</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">state</td><td>ptr to previously used state structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bytes</td><td>data to re-write in the first page </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">len</td><td>size of data in bytes (must be &lt;=FLASHPAGE_SIZE)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, &lt;0 otherwise </dd></dl>

</div>
</div>
<a id="a43c19f2a98b8671fb9785aad3ba63eea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43c19f2a98b8671fb9785aad3ba63eea">&#9670;&nbsp;</a></span>riotboot_flashwrite_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int riotboot_flashwrite_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structriotboot__flashwrite__t.html">riotboot_flashwrite_t</a> *&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>target_slot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize firmware update (riotboot version) </p>
<p>This function initializes a firmware update, skipping riotboot's magic number ("RIOT") by calling <a class="el" href="flashwrite_8h.html#a8f63924bc9bf572db48bb24336b3e8c2">riotboot_flashwrite_init_raw()</a> with an offset of RIOTBOOT_FLASHWRITE_SKIPLEN (4). This ensures that riotboot will ignore the slot until the magic number has been restored, e.g., through <a class="el" href="flashwrite_8h.html#af394e6c45f029eaa246c756383be8378">riotboot_flashwrite_finish()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state</td><td>ptr to preallocated state structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">target_slot</td><td>slot to write update into</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, &lt;0 otherwise </dd></dl>

<p class="definition">Definition at line <a class="el" href="flashwrite_8h_source.html#l00111">111</a> of file <a class="el" href="flashwrite_8h_source.html">flashwrite.h</a>.</p>

</div>
</div>
<a id="a8f63924bc9bf572db48bb24336b3e8c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f63924bc9bf572db48bb24336b3e8c2">&#9670;&nbsp;</a></span>riotboot_flashwrite_init_raw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int riotboot_flashwrite_init_raw </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structriotboot__flashwrite__t.html">riotboot_flashwrite_t</a> *&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>target_slot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="msp430__types_8h.html#a7c94ea6f8948649f8d181ae55911eeaf">size_t</a>&#160;</td>
          <td class="paramname"><em>offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize firmware update (raw version) </p>
<p>Allows setting the initial offset to <code>offset</code>, which would mean that the first bytes passed in via <a class="el" href="flashwrite_8h.html#af8f53f0bca4123772b1221bed52abcca">riotboot_flashwrite_putbytes()</a> will be written to (slot_start + offset).</p>
<dl class="section note"><dt>Note</dt><dd>offset <em>should</em> be &lt;= FLASHPAGE_SIZE, otherwise the results are undefined.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state</td><td>ptr to preallocated state structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">target_slot</td><td>slot to write update into </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">offset</td><td>Bytes offset to start write at</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, &lt;0 otherwise </dd></dl>

</div>
</div>
<a id="af8f53f0bca4123772b1221bed52abcca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8f53f0bca4123772b1221bed52abcca">&#9670;&nbsp;</a></span>riotboot_flashwrite_putbytes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int riotboot_flashwrite_putbytes </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structriotboot__flashwrite__t.html">riotboot_flashwrite_t</a> *&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="msp430__types_8h.html#a7c94ea6f8948649f8d181ae55911eeaf">size_t</a>&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>more</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Feed bytes into the firmware writer. </p>
<dl class="section note"><dt>Note</dt><dd>If the update has been initialized via <a class="el" href="flashwrite_8h.html#a43c19f2a98b8671fb9785aad3ba63eea">riotboot_flashwrite_init()</a>, make sure to skip the first RIOTBOOT_FLASHWRITE_SKIPLEN bytes.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state</td><td>ptr to previously used update state </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bytes</td><td>ptr to data </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">len</td><td>len of data </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">more</td><td>whether more data is coming</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, &lt;0 otherwise </dd></dl>

</div>
</div>
<a id="a68b26d35167bd543d9f2fc1156290db8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68b26d35167bd543d9f2fc1156290db8">&#9670;&nbsp;</a></span>riotboot_flashwrite_slotsize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="msp430__types_8h.html#a7c94ea6f8948649f8d181ae55911eeaf">size_t</a> riotboot_flashwrite_slotsize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structriotboot__flashwrite__t.html">riotboot_flashwrite_t</a> *&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a slot's size. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">state</td><td>ptr to state struct</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the size of the slot that <code>state</code> is configured to update to </dd></dl>

</div>
</div>
<a id="a56dfacc4a69c91d00803807521b3d775"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56dfacc4a69c91d00803807521b3d775">&#9670;&nbsp;</a></span>riotboot_flashwrite_verify_sha256()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int riotboot_flashwrite_verify_sha256 </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>sha256_digest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="msp430__types_8h.html#a7c94ea6f8948649f8d181ae55911eeaf">size_t</a>&#160;</td>
          <td class="paramname"><em>img_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>target_slot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verify the digest of an image. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sha256_digest</td><td>content of the image digest </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">img_size</td><td>the size of the image </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">target_slot</td><td>the image slot number</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>-1 when image is too small </dd>
<dd>
0 if the digest is valid </dd>
<dd>
1 if the digest is invalid </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
    <div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
        <ul>
            <li class="footer">Generated on Wed Jul 1 2020 17:08:57 by <a href="http://www.doxygen.org/index.html">
                       <img class="footer" src="doxygen.png" alt="doxygen"></a> 1.8.13</li>
        </ul>
    </div>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap.min.js"></script>
    <script src="jquery.smartmenus.min.js"></script>
    <script src="jquery.smartmenus.bootstrap.min.js"></script>
    <script src="riot-doxy.js"></script>
  </body>
</html>
